工业传感器模糊测试框架：项目目的与文件功能说明

一、文档目的
本说明文档用于帮助首次接触本项目的成员快速建立整体认知，明确：
1) 项目的业务目标与技术目标；
2) 代码结构的分层逻辑；
3) 关键目录与核心文件的职责边界；
4) 系统从启动到产出结果的执行链路；
5) 运维与交付过程中应关注的入口文件。

二、项目定位与建设目标
1. 项目定位
本项目是一个面向工业传感器场景的模糊测试框架，目标是自动化发现协议与数据层面的异常行为，并输出可用于安全评估（SIL 合规验证）的结果。

2. 建设目标
(1) 工程化测试：将手工测试转为可重复、可扩展、可追溯的自动化流程。
(2) 协议覆盖：支持多类工业/通信协议驱动执行与异常注入。
(3) 可观测性：提供运行状态、性能指标与健康检查能力。
(4) 合规验证：结合 IEC 61508 SIL 等级要求生成合规分析结果。
(5) 部署友好：支持本地脚本运行与 Docker/Compose 部署。

三、总体架构（从产品视角）
系统遵循“配置驱动 + 引擎执行 + 指标监控 + 合规评估”的闭环：
- 输入：配置文件（协议、传感器、策略、SIL 目标）
- 处理：测试用例生成、并发调度、协议驱动发送、结果聚合
- 输出：监控指标、状态查询、SIL 合规报告、日志与检查点

四、目录与文件结构说明（核心）
A. 根目录关键文件
1) README.md
- 作用：项目总览、能力说明、基础启动方式。

2) QUICK_START.md
- 作用：面向新用户的快速操作指南，降低首次使用门槛。

3) pyproject.toml
- 作用：Python 包构建与元信息定义（项目名、版本、包目录映射等）。

4) consolidated_requirements.txt
- 作用：统一依赖清单，供本地与容器环境安装使用。

5) 项目快捷脚本（Windows）
- sf-start.cmd / sf-start.ps1：一键启动服务与测试容器流程。
- sf-stop.cmd / sf-stop.ps1：停止服务。
- sf-status.cmd / sf-status.ps1：查询容器状态与 HTTP 可用性。

6) setup_and_run.ps1 / setup_and_run.sh
- 作用：快速初始化运行环境（本地分发场景）。

7) setup_github.ps1
- 作用：生成或维护 GitHub 相关配置（如仓库链接配置）。

8) create_distribution.ps1 / create_distribution.sh
- 作用：构建分发包，便于离线交付或版本打包。

B. 核心源码目录：src/sensor_fuzz
1) __main__.py
- 作用：程序主入口，负责完整启动流程编排。
- 主要职责：
  - 初始化日志、监控、指标服务；
  - 加载并校验配置；
  - 初始化执行引擎与配置热重载；
  - 启动测试主流程；
  - 触发 SIL 合规验证并输出报告；
  - 执行优雅退出与资源回收。

2) config/
- 作用：配置模型、加载校验、版本管理与热更新。
- 代表文件：
  - loader.py：读取 YAML/JSON，执行 schema 与业务规则校验。
  - config_manager.py：配置兼容性与运行时管理。
  - reloader.py：配置变更监听与回调生效。
  - versioning.py：配置快照存储与版本追踪。

3) data_gen/
- 作用：测试数据与异常样本生成层。
- 内容类型：边界值、异常值、协议错误、信号扰动、POC 任务与预检查。

4) engine/
- 作用：执行引擎层，完成任务调度与协议驱动执行。
- 代表文件：
  - runner.py：核心执行编排（构建用例、并发下发、结果汇总、checkpoint）。
  - drivers.py / async_drivers.py：协议驱动实现与异步发送支持。
  - concurrency.py：并发执行控制。
  - memory_pool.py：连接对象池与资源复用。
  - checkpoint.py：断点/状态存储。

5) monitoring/
- 作用：监控与可观测模块。
- 代表文件：
  - exporter.py：指标导出与 dashboard/health 接口。
  - collector.py：系统统计信息采集。
  - metrics.py：统一指标定义与上报。

6) sil_compliance.py
- 作用：SIL 合规验证核心逻辑。
- 功能：
  - 定义 SIL1-SIL4 要求；
  - 校验测试结果是否满足阈值；
  - 生成合规评分、问题列表与改进建议。

7) 其余模块
- ai/：AI 增强能力（如异常检测辅助）。
- analysis/：结果分析与报告辅助。
- distributed/：分布式调度客户端能力。
- security/：审计、访问控制、加密等安全能力。
- utils/：通用工具（如日志初始化）。

C. 部署目录：deploy/
1) docker-compose.yml
- 作用：多服务编排（应用、Prometheus、Grafana 等）。

2) Dockerfile
- 作用：构建应用镜像（开发/生产阶段）。

3) scripts/deploy_windows.ps1
- 作用：Windows 部署主脚本，封装镜像构建、容器拉起、冒烟测试等步骤。

4) prometheus.yml 与 grafana/
- 作用：监控系统配置与看板预置。

D. 配置目录：config/
1) sensor_protocol_config.yaml
- 作用：定义协议、传感器、执行策略与 SIL 映射，是运行行为的核心输入。

2) config.yaml
- 作用：通用配置入口（按项目约定扩展）。

E. 测试与验证目录
1) tests/
- 作用：单元与集成测试集合。

2) 根目录验证脚本（示例）
- sil_compliance_test.py：SIL 合规相关测试。
- memory_test.py / memory_stability_test.py：内存与稳定性验证。
- async_driver_performance_test.py / genetic_performance_test.py：性能与算法专项验证。

五、系统运行链路（执行机制）
1. 启动阶段
- 通过快捷脚本或命令启动后，主入口 __main__.py 完成日志、监控、指标服务初始化。

2. 配置阶段
- 读取 config/sensor_protocol_config.yaml；
- 校验配置格式与业务规则（协议配置、传感器映射、SIL 参数等）。

3. 执行阶段
- 执行引擎依据配置生成测试用例（边界、异常、协议错误、扰动等）；
- 按并发策略调用协议驱动发送；
- 记录结果、性能指标、异常计数，并保存 checkpoint。

4. 合规阶段
- 使用测试结果与系统能力参数执行 SIL 校验；
- 生成合规报告（如 sil_compliance_report.json）。

5. 可观测阶段
- 通过 status 脚本或监控端点查看服务健康与指标状态。

六、建议的讲解顺序（面向“从零到一”）
建议按“价值 -> 结构 -> 跑通 -> 深入”的顺序讲解：
1) 先讲价值：为何需要自动化工业模糊测试与 SIL 验证；
2) 再讲结构：src/deploy/config/tests 四层职责；
3) 再演示跑通：sf-start -> sf-status -> 结果输出；
4) 最后讲实现：__main__.py 主编排 + engine/runner.py 执行核心 + sil_compliance.py 评估核心。

七、运行与交付入口（推荐）
Windows：
- 启动：sf-start.cmd
- 状态：sf-status.cmd
- 停止：sf-stop.cmd

容器部署：
- 主要编排文件：deploy/docker-compose.yml
- 主要部署脚本：deploy/scripts/deploy_windows.ps1

八、维护建议
1) 保持“配置驱动”原则：新增功能优先通过配置注入而非硬编码。
2) 新协议扩展优先放在 engine/drivers 与 data_gen 对应链路。
3) 任何影响 SIL 结论的逻辑变更，应同步更新 sil_compliance 测试。
4) 交付前固定执行：启动检查、状态检查、关键测试、报告核验。

—— 文档完 ——
